<?xml version="1.0"?>
<project name="test_S20-59" default="archive" basedir=".">
  <description>Struts2 S2-059（CVE-2019-0230）</description>

  <property file="build.properties"/>
  <target name="clean" description="Delete old directories and files">
    <delete dir="${dist.home}"/>
    <delete dir="${build.home}"/>
    <delete >
      <fileset dir="${source.home}" includes="**/*.class"/>
    </delete>
  </target>

  <target name="init" depends="clean"  description="Create build directory">
    <mkdir dir="${build.home}" />
  </target>

  <target name="compile" depends="init" description="Compile Java sources">
    <mkdir dir="${build.home}/WEB-INF/classes" />
    <javac srcdir="${source.home}"
           destdir="${build.home}/WEB-INF/classes"
           debug="${compile.debug}"
           deprecation="${compile.deprecation}"
           optimize="${compile.optimize}"
           source="1.7" target="1.7" includeantruntime="on">
      <classpath>
        <path>
          <fileset dir="${lib.home}" />
        </path>
      </classpath>
    </javac>
  </target>

  <target name="build" depends="compile" description="Copies all non Java classes to build directoy">
    <copy todir="${build.home}">
      <fileset dir="${webapp.home}" excludes="SVN,**/*.class" />
    </copy>
    <copy todir="${build.home}/WEB-INF/classes">
      <fileset dir="${source.home}" excludes="SVN,**/*.java" />
    </copy>
  </target>

  <target name="war" depends="build" description="Create binary archive of all files in dist.home">
    <mkdir dir="${dist.home}" />
    <jar jarfile="${dist.home}/${app.name}.war" basedir="${build.home}" />
  </target>

</project>
