* 说明
S2-059 Apache Struts2 远程代码执行漏洞（CVE-2019-0230）的验证环境。使用的 Struts2 2.5.20。

* 环境搭建
依赖 ant 命令，请先安装。

搭建步骤：

1. 编译、打 war 包：

#+begin_example
  ant war
#+end_example

2. 将 dist/test_S2-059.war 部署到 Tomcat 中。

*注意*：

1. Tomcat 8.x 以上版本限制了 URI 中出现的有效字符，因此在触发时可能会提示：

#+begin_example
  在请求目标中找到无效字符。有效字符在RFC 7230和RFC 3986中定义
#+end_example

解决方法：

1. 使用 Tomcat 7；

2. Tomcat 8 可以在 conf/catalina.properties 中添加（如果不行，请网上查查，我没完整验证过）：

#+begin_example
  tomcat.util.http.parser.HttpParser.requestTargetAllow=|{}
#+end_example

3. Tomcat 9，修改 conf/server.xml 以下：

#+begin_src xml
  <Connector port="8080" protocol="HTTP/1.1"
             connectionTimeout="20000"
             redirectPort="8443" />
#+end_src

为：

#+begin_src xml
  <Connector port="8080" protocol="HTTP/1.1"
             connectionTimeout="20000"
             relaxedQueryChars="[]|{}^&#x5c;&#x60;&quot;&lt;&gt;"
             redirectPort="8443" />
#+end_src

* 漏洞测试：
#+begin_example
  curl -XPOST http://127.0.0.1:8080/test_S2-059/test_execute.action -d 'id=vul%25{245%2b5}'
#+end_example
